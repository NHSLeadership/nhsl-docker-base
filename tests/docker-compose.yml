version: '3'
services:
  openresty:
    container_name: openresty
    build:
      context: ./openresty/
      dockerfile: Dockerfile
    ports:
      - "8080:8080"
    volumes:
      - ./app/:/app/public/

  phpfpm:
    container_name: phpfpm
    build:
      context: ./phpfpm/
      dockerfile: Dockerfile
      args:
        PHP_VERSION: ${phpvers}
        PHP_PACKAGES: |-
          ${phpmods}
    network_mode: "container:openresty"
    volumes:
      - ./app/:/app/public/
    depends_on:
      - openresty